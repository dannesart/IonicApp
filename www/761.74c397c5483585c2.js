"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[761],{761:(B,C,l)=>{l.r(C),l.d(C,{ContractsModule:()=>z});var x=l(9180),e=l(9102),g=l(5861),y=l(6308),f=l(8776),v=l(4961),m=l(591),t=l(6353),p=l(6895),Z=l(2593);function w(n,r){if(1&n&&(t.TgZ(0,"ion-card",15)(1,"ion-card-content"),t._uU(2),t.qZA()()),2&n){const o=t.oxw().ngIf;t.xp6(2),t.hij(" ",o.error," ")}}function T(n,r){1&n&&(t.ynx(0),t._uU(1," Create contract "),t.BQk())}function M(n,r){1&n&&t._UZ(0,"ion-spinner",16)}const N=function(n){return{loading:n}};function A(n,r){if(1&n){const o=t.EpF();t.TgZ(0,"ion-content",4),t.YNc(1,w,3,1,"ion-card",5),t.TgZ(2,"ion-grid")(3,"ion-row")(4,"ion-col")(5,"p-input",6),t.NdJ("valueChange",function(i){t.CHM(o);const c=t.oxw();return t.KtG(c.updateValue(i,"description"))}),t.ALo(6,"async"),t.qZA()()(),t.TgZ(7,"ion-row")(8,"ion-col")(9,"p-input",7),t.NdJ("valueChange",function(i){t.CHM(o);const c=t.oxw();return t.KtG(c.updateValue(i,"targetPeyya"))}),t.ALo(10,"async"),t.qZA()()(),t.TgZ(11,"ion-row")(12,"ion-col")(13,"p-input",8),t.NdJ("valueChange",function(i){t.CHM(o);const c=t.oxw();return t.KtG(c.updateValue(i,"amount"))}),t.ALo(14,"async"),t.qZA()()(),t.TgZ(15,"ion-row",9)(16,"ion-col")(17,"p-input",10),t.NdJ("valueChange",function(i){t.CHM(o);const c=t.oxw();return t.KtG(c.updateValue(i,"expirationDate"))}),t.ALo(18,"async"),t.qZA()()(),t.TgZ(19,"ion-row")(20,"ion-col",11)(21,"ion-button",12),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.createContract())}),t.YNc(22,T,2,0,"ng-container",13),t.YNc(23,M,1,0,"ng-template",null,14,t.W1O),t.qZA()()()()()}if(2&n){const o=r.ngIf,a=t.MAs(24),i=t.oxw();t.xp6(1),t.Q6J("ngIf",o.error),t.xp6(4),t.Q6J("value",t.lcZ(6,20,i.description$))("label","Description")("placeholder","..."),t.xp6(4),t.Q6J("label","Contract part")("placeholder","+xx xx xxxxxxx")("value",t.lcZ(10,22,i.targetPeyya$))("type","user"),t.xp6(4),t.Q6J("label","Amount (\u20ac)")("placeholder","Set amount")("type","numberSelect")("value",t.lcZ(14,24,i.amount$)),t.xp6(4),t.Q6J("value",t.lcZ(18,26,i.expirationDate$))("type","date")("label","Expiration date")("placeholder","Expiration date"),t.xp6(4),t.Q6J("ngClass",t.VKq(28,N,o.creating))("color",o.creating?"medium":"primary"),t.xp6(1),t.Q6J("ngIf",!o.creating)("ngIfElse",a)}}let O=(()=>{class n{constructor(o,a,i){var c=this;this.modalController=o,this.contract=a,this.user=i,this.description$=new m.X(null),this.targetPeyya$=new m.X(null),this.amount$=new m.X(null),this.expirationDate$=new m.X(null),this.contract$=this.contract.getContracts$(),this.updateValue=function(){var u=(0,g.Z)(function*(s,d){"description"===d&&c.description$.next(s.value||s.target.value),"amount"===d&&c.amount$.next(s.value||s.target.value),"targetPeyya"===d&&c.targetPeyya$.next(s.value||s.target.value),"expirationDate"===d&&c.expirationDate$.next(s.value||s.target.value)});return function(s,d){return u.apply(this,arguments)}}(),this.createContract=(0,g.Z)(function*(){yield c.contract.updateContract({error:null,creating:!0});try{const u=yield c.user.getRecipientBasedOnPhone(c.targetPeyya$.value);if(!u.length)throw new Error("No valid user");const s={amount:c.amount$.value,expirationDate:c.expirationDate$.value,concept:c.description$.value,targetPeyya:u[0]._id||u[0].id};yield c.contract.create(s),yield c.contract.updateContract({creating:!1})}catch(u){console.log("Error while creating contract",u),yield c.contract.updateContract({error:u,creating:!1})}}),this.close=(0,g.Z)(function*(){yield c.reset(),yield c.modalController.dismiss(void 0,void 0,"new-contract-in")}),this.reset=(0,g.Z)(function*(){})}ngOnDestroy(){}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(e.IN),t.Y36(f.U),t.Y36(v.f))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-new-contract"]],decls:9,vars:3,consts:[["color","dark","slot","start"],["slot","end"],["fill","clear","color","tertiary",3,"click"],["fullscreen","true",4,"ngIf"],["fullscreen","true"],["color","danger","class","my-0 shadow-none",4,"ngIf"],[3,"value","label","placeholder","valueChange"],[3,"label","placeholder","value","type","valueChange"],[3,"label","placeholder","type","value","valueChange"],[1,"text-center"],[3,"value","type","label","placeholder","valueChange"],["align-self-center","","size-xs","12",1,"p-4"],["size","large","expand","block",1,"button",3,"ngClass","color","click"],[4,"ngIf","ngIfElse"],["spinner",""],["color","danger",1,"my-0","shadow-none"],["name","crescent","color","light"]],template:function(o,a){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),t._uU(3,"Create new contract"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t.NdJ("click",function(){return a.close()}),t._uU(6," Close "),t.qZA()()()(),t.YNc(7,A,25,30,"ion-content",3),t.ALo(8,"async")),2&o&&(t.xp6(7),t.Q6J("ngIf",t.lcZ(8,1,a.contract$)))},dependencies:[p.mk,p.O5,e.YG,e.Sm,e.PM,e.FN,e.wI,e.W2,e.jY,e.Gu,e.Nd,e.PQ,e.wd,e.sr,Z.a,p.Ov],styles:["[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]{padding:20px 10px}.button[_ngcontent-%COMP%]{transition:all .3s ease-in-out;display:inline-block;width:100%}.button.loading[_ngcontent-%COMP%]{width:100px}ion-toolbar[_ngcontent-%COMP%]:last-of-type{--border-width: 0px}"]}),n})();var P=l(9450);let b=(()=>{class n{constructor(){}iconByStatus(o){return"layers-outline"}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["mini-contract"]],inputs:{contract:"contract"},decls:11,vars:8,consts:[[1,"icon"],[3,"name"],[1,"content"],[1,"price"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0),t._UZ(1,"ion-icon",1),t.qZA(),t.TgZ(2,"div",2)(3,"h3"),t._uU(4,"Contract info"),t.qZA(),t.TgZ(5,"time"),t._uU(6),t.ALo(7,"date"),t.qZA()(),t.TgZ(8,"div",3),t._uU(9),t.ALo(10,"currency"),t.qZA()),2&o&&(t.xp6(1),t.Q6J("name",a.iconByStatus(a.contract.status)),t.xp6(5),t.hij(" ",t.lcZ(7,3,a.contract.expiration)," "),t.xp6(3),t.hij(" ",t.xi3(10,5,a.contract.amount,"EUR"),"\n"))},dependencies:[e.gu,p.H9,p.uU],styles:['[_nghost-%COMP%]{box-shadow:2px 8px 48px -16px #1546a01a;background:#f4f5f8!important;background:var(--ion-color-light, #f4f5f8)!important;border-radius:8px;padding:1rem;margin:1.5rem 1rem;display:grid;grid-template-areas:"icon content price";grid-template-columns:auto 1fr auto;grid-template-rows:32px;align-items:center;color:var(--ion-color-dark)}[_nghost-%COMP%]   .icon[_ngcontent-%COMP%]{grid-area:icon}[_nghost-%COMP%]   .icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{grid-area:content}[_nghost-%COMP%]   .price[_ngcontent-%COMP%]{grid-area:price;font-size:13px;color:var(--ion-color-success)}']}),n})();function J(n,r){1&n&&(t.TgZ(0,"ion-card",11)(1,"ion-card-content",12)(2,"ion-text",13),t._uU(3," There is no contracts yet. Let's start peyya! "),t.qZA()(),t._UZ(4,"ion-ripple-effect"),t.qZA())}function I(n,r){1&n&&t._UZ(0,"mini-contract",14),2&n&&t.Q6J("contract",r.$implicit)}function U(n,r){if(1&n&&(t.TgZ(0,"ion-col",8),t.YNc(1,J,5,0,"ion-card",9),t.YNc(2,I,1,1,"mini-contract",10),t.qZA()),2&n){const o=r.ngIf;t.xp6(1),t.Q6J("ngIf",!o.contracts.length),t.xp6(1),t.Q6J("ngForOf",o.contracts)}}let Y=(()=>{class n{constructor(o,a,i,c,u){var s=this;this.modalController=o,this.page=a,this.routerOutlet=i,this.contract=c,this.auth=u,this.doRefresh=function(){var d=(0,g.Z)(function*(h){try{yield s.contract.triggerFetch()}catch{}h.target.complete()});return function(h){return d.apply(this,arguments)}}(),this.presentNewContractModal=(0,g.Z)(function*(){return yield(yield s.modalController.create({component:O,cssClass:"new-contract-in",id:"new-contract-in",swipeToClose:!0,showBackdrop:!0,presentingElement:s.routerOutlet.nativeEl})).present()}),this.contracts$=c.getContracts$()}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(e.IN),t.Y36(P.P),t.Y36(e.jP),t.Y36(f.U),t.Y36(y.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-contracts"]],decls:11,vars:4,consts:[[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"absolute","inset-0","top-10","text-center","safe-space-m"],["justify-content-center",""],["align-self-center","","size-xs","12",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","secondary",3,"click"],["name","add"],["align-self-center","","size-xs","12"],["color","warning","class","shadow-none",4,"ngIf"],[3,"contract",4,"ngFor","ngForOf"],["color","warning",1,"shadow-none"],[1,"text-4xl"],[1,"text-base","max-w-full","block"],[3,"contract"]],template:function(o,a){1&o&&(t.TgZ(0,"ion-content",0)(1,"ion-refresher",1),t.NdJ("ionRefresh",function(c){return a.doRefresh(c)}),t._UZ(2,"ion-refresher-content"),t.qZA(),t.TgZ(3,"section",2)(4,"ion-grid")(5,"ion-row",3),t.YNc(6,U,3,2,"ion-col",4),t.ALo(7,"async"),t.qZA()()(),t.TgZ(8,"ion-fab",5)(9,"ion-fab-button",6),t.NdJ("click",function(){return a.presentNewContractModal()}),t._UZ(10,"ion-icon",7),t.qZA()()()),2&o&&(t.Q6J("fullscreen",!0),t.xp6(6),t.Q6J("ngIf",t.lcZ(7,2,a.contracts$)))},dependencies:[p.sg,p.O5,e.PM,e.FN,e.wI,e.W2,e.IJ,e.W4,e.jY,e.gu,e.nJ,e.Wo,e.H$,e.Nd,e.yW,b,p.Ov],styles:["[_ngcontent-%COMP%]:root{--backdrop-opacity: 1}ion-fab[_ngcontent-%COMP%]{bottom:120px}"]}),n})();var _=l(5586);const $=[{path:"",component:Y}];let Q=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.Bz.forChild($),_.Bz]}),n})();var F=l(7999),j=l(20);let z=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.ez,Q,e.Pc,x._,F.h,j.u]}),n})()}}]);